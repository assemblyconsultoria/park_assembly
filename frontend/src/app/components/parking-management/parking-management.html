<div class="parking-management">
  <div class="header">
    <h2>Gerenciamento de Estacionamento</h2>
    <button (click)="openCreateModal()" class="btn-primary">+ Registrar Entrada</button>
  </div>

  <div class="search-filters">
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="searchPlaca"
        placeholder="Buscar por placa..."
        (keyup.enter)="searchByPlaca()"
      />
      <button (click)="searchByPlaca()" class="btn-search">Buscar</button>
      <button (click)="clearSearch()" class="btn-clear">Limpar</button>
    </div>
    
    <div class="filter-status">
      <label>Status:</label>
      <select [(ngModel)]="filterStatus" (change)="loadCars()">
        <option value="all">Todos</option>
        <option value="active">Ativos</option>
        <option value="exited">Saidas Registradas</option>
      </select>
    </div>
  </div>

  <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>
  <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>

  <div class="stats">
    <div class="stat-card">
      <h3>{{ filteredCars.length }}</h3>
      <p>Total de Veiculos</p>
    </div>
    <div class="stat-card active">
      <h3>{{ (cars | filter: 'active').length }}</h3>
      <p>Veiculos Ativos</p>
    </div>
    <div class="stat-card exited">
      <h3>{{ (cars | filter: 'exited').length }}</h3>
      <p>Saidas Registradas</p>
    </div>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Placa</th>
          <th>Modelo</th>
          <th>Cor</th>
          <th>Proprietario</th>
          <th>Entrada</th>
          <th>Saida</th>
          <th>Status</th>
          <th>Acoes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let car of filteredCars" [class.exited]="!isActive(car)">
          <td><strong>{{ car.placa }}</strong></td>
          <td>{{ car.modelo }}</td>
          <td>{{ car.cor }}</td>
          <td>{{ car.nomeProprietario }}</td>
          <td>{{ formatDateTime(car.dataEntrada) }}</td>
          <td>{{ formatDateTime(car.dataSaida) }}</td>
          <td>
            <span class="status-badge" [class.status-active]="isActive(car)" [class.status-exited]="!isActive(car)">
              {{ isActive(car) ? 'Ativo' : 'Saida' }}
            </span>
          </td>
          <td class="actions">
            <button 
              (click)="openEditModal(car)" 
              class="btn-edit" 
              title="Editar"
              [disabled]="!isActive(car)"
            >
              Editar
            </button>
            <button 
              (click)="registerExit(car.id!)" 
              class="btn-exit" 
              title="Registrar Saida"
              [disabled]="!isActive(car)"
            >
              Saida
            </button>
            <button 
              (click)="deleteCar(car.id!)" 
              class="btn-delete" 
              title="Excluir"
            >
              Excluir
            </button>
          </td>
        </tr>
        <tr *ngIf="filteredCars.length === 0">
          <td colspan="8" style="text-align: center">Nenhum veiculo encontrado</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal Carro -->
  <div class="modal" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>{{ isEditMode ? 'Editar Veiculo' : 'Registrar Entrada' }}</h3>
      <form (ngSubmit)="saveCar()" #carForm="ngForm">
        <div class="form-group">
          <label>Placa *</label>
          <input 
            type="text" 
            [(ngModel)]="currentCar.placa" 
            name="placa" 
            required 
            placeholder="ABC-1234"
            [disabled]="isEditMode"
          />
        </div>
        <div class="form-group">
          <label>Modelo *</label>
          <input 
            type="text" 
            [(ngModel)]="currentCar.modelo" 
            name="modelo" 
            required 
            placeholder="Ex: Civic, Gol, Corolla"
          />
        </div>
        <div class="form-group">
          <label>Cor *</label>
          <input 
            type="text" 
            [(ngModel)]="currentCar.cor" 
            name="cor" 
            required 
            placeholder="Ex: Preto, Branco, Prata"
          />
        </div>
        <div class="form-group">
          <label>Proprietario *</label>
          <input 
            type="text" 
            [(ngModel)]="currentCar.nomeProprietario" 
            name="nomeProprietario" 
            required 
            placeholder="Nome completo"
          />
        </div>
        <div class="modal-actions">
          <button type="button" (click)="closeModal()" class="btn-cancel">Cancelar</button>
          <button type="submit" [disabled]="!carForm.valid" class="btn-save">Salvar</button>
        </div>
      </form>
    </div>
  </div>
</div>
